<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Secret Whispers</title>
        <style nonce="{{ nonce }}">
            * {
                box-sizing: border-box;
            }

            body {
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                margin: 0;
                font-family: Arial, Helvetica, sans-serif;
                background: linear-gradient(
                    135deg,
                    #ffe1f2 0%,
                    #fde4ff 30%,
                    #e8f1ff 65%,
                    #dffdfc 100%
                );
                color: #30445c;
            }

            .whisper-shell {
                position: relative;
                width: min(92vw, 520px);
                padding: 2.7rem 3.2rem 3.6rem;
                border-radius: 32px;
                background: linear-gradient(
                    160deg,
                    rgba(255, 255, 255, 0.92),
                    rgba(255, 255, 255, 0.82)
                );
                box-shadow: 0 30px 60px rgba(76, 96, 128, 0.18),
                    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
                text-align: center;
                overflow: hidden;
            }

            .whisper-shell::before,
            .whisper-shell::after {
                content: "";
                position: absolute;
                inset: -60px -40px auto auto;
                width: 220px;
                height: 220px;
                background: radial-gradient(
                    circle,
                    rgba(255, 209, 229, 0.35),
                    rgba(255, 209, 229, 0)
                );
                transform: rotate(11deg);
                z-index: 0;
            }

            .whisper-shell::after {
                inset: auto auto -80px -90px;
                background: radial-gradient(
                    circle,
                    rgba(210, 231, 255, 0.42),
                    rgba(210, 231, 255, 0)
                );
            }

            .whisper-header {
                position: relative;
                z-index: 1;
                margin-bottom: 1.6rem;
            }

            .whisper-header h1 {
                margin: 0;
                font-size: clamp(2.2rem, 4.8vw, 3.3rem);
                letter-spacing: 0.08em;
                text-transform: uppercase;
                color: #415770;
            }

            .subtitle {
                margin: 0.55rem 0 0;
                font-size: clamp(1.05rem, 3vw, 1.2rem);
                color: rgba(65, 87, 112, 0.75);
            }

            .message-card {
                position: relative;
                margin: 0 auto 1.1rem;
                width: min(72vw, 200px);
                aspect-ratio: 1 / 1;
                border-radius: 22px;
                background: linear-gradient(
                    145deg,
                    rgba(255, 255, 255, 0.94),
                    rgba(246, 248, 255, 0.92)
                );
                box-shadow: 0 16px 30px rgba(87, 109, 139, 0.14);
                display: grid;
                place-items: center;
                user-select: none;
                cursor: not-allowed;
                z-index: 1;
                text-align: center;
                padding: 1.6rem;
                border: 1px solid rgba(196, 211, 232, 0.5);
            }

            .message-text {
                margin: 0;
                font-size: clamp(1.45rem, 4.8vw, 2.15rem);
                font-weight: 600;
                color: #4a6181;
                line-height: 1.35;
                white-space: pre-wrap;
                word-break: break-word;
                text-shadow: 0 1px 0 rgba(255, 255, 255, 0.9);
            }

            .message-card:focus {
                outline: none;
                box-shadow: 0 0 0 3px rgba(207, 224, 255, 0.6),
                    0 16px 30px rgba(87, 109, 139, 0.14);
            }

            .message-card > * {
                pointer-events: none;
            }

            .token-card {
                margin: 0 auto 1.3rem;
                display: inline-flex;
                align-items: center;
                gap: 0.65rem;
                padding: 0.75rem 1.25rem;
                border-radius: 16px;
                background: rgba(210, 231, 255, 0.3);
                color: #4a6181;
                font-weight: 600;
                letter-spacing: 0.08em;
                z-index: 1;
            }

            .token-card::before {
                content: "seal";
                font-size: 0.75rem;
                letter-spacing: 0.28em;
                color: rgba(255, 159, 206, 0.85);
                text-transform: uppercase;
            }

            .stamp {
                position: absolute;
                top: 1.6rem;
                right: 2rem;
                width: 66px;
                height: 66px;
                border-radius: 18px;
                background: linear-gradient(
                    145deg,
                    rgba(255, 224, 244, 0.75),
                    rgba(207, 233, 255, 0.75)
                );
                box-shadow: 0 12px 22px rgba(84, 104, 132, 0.18);
                opacity: 0.95;
                z-index: 0;
                display: grid;
                place-items: center;
                color: rgba(255, 255, 255, 0.95);
                padding: 10px;
            }

            .stamp-icon {
                width: 60%;
                height: 60%;
            }

            .shake {
                animation: shake 0.6s ease-in-out;
            }

            @keyframes shake {
                0% {
                    transform: translateX(0);
                }
                20% {
                    transform: translateX(-6px);
                }
                40% {
                    transform: translateX(6px);
                }
                60% {
                    transform: translateX(-4px);
                }
                80% {
                    transform: translateX(4px);
                }
                100% {
                    transform: translateX(0);
                }
            }
        </style>
    </head>
    <body>
        <div class="whisper-shell">
            <div class="stamp" aria-hidden="true">
                <svg
                    class="stamp-icon"
                    width="24px"
                    height="24px"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M7 9L12 12.5L17 9"
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M2 17V7C2 5.89543 2.89543 5 4 5H20C21.1046 5 22 5.89543 22 7V17C22 18.1046 21.1046 19 20 19H4C2.89543 19 2 18.1046 2 17Z"
                        stroke="currentColor"
                    />
                </svg>
            </div>
            <header class="whisper-header">
                <h1>Secret Whispers</h1>
                <p class="subtitle">
                    What happens in the here, stays in the here.
                </p>
            </header>

            {% if token %}
            <div class="token-card">{{ token }}</div>
            {% endif %}

            <div
                class="message-card"
                data-role="message-card"
                data-protected="true"
                tabindex="0"
            >
                <p class="message-text">{{ message | safe}}</p>
            </div>
        </div>

        <script nonce="{{ nonce }}">
            (function () {
                var protectedZones = document.querySelectorAll(
                    '[data-role="message-card"]'
                );

                function block(event) {
                    event.preventDefault();
                }

                function hijack(event) {
                    event.preventDefault();
                    if (event.clipboardData) {
                        event.clipboardData.setData(
                            "text/plain",
                            "Access denied: decode the base64 manually."
                        );
                    }
                }

                function antiClick(event) {
                    if (event.detail > 1) {
                        event.preventDefault();
                        var element = event.currentTarget;
                        element.classList.add("shake");
                        window.setTimeout(function () {
                            element.classList.remove("shake");
                        }, 600);
                    }
                }

                function preventKeys(event) {
                    if (
                        (event.ctrlKey || event.metaKey) &&
                        (event.key === "c" ||
                            event.key === "x" ||
                            event.key === "a")
                    ) {
                        event.preventDefault();
                    }
                }

                protectedZones.forEach(function (zone) {
                    zone.addEventListener("contextmenu", block);
                    zone.addEventListener("selectstart", block);
                    zone.addEventListener("dragstart", block);
                    zone.addEventListener("copy", hijack);
                    zone.addEventListener("mousedown", antiClick);
                    zone.addEventListener("keydown", preventKeys);
                });

                document.addEventListener("copy", function (event) {
                    var selection = window.getSelection
                        ? window.getSelection()
                        : null;
                    if (!selection || !selection.anchorNode) {
                        return;
                    }

                    var focusNode =
                        selection.anchorNode.nodeType === Node.TEXT_NODE
                            ? selection.anchorNode.parentNode
                            : selection.anchorNode;

                    if (
                        focusNode &&
                        focusNode.closest('[data-role="message-card"]')
                    ) {
                        event.preventDefault();
                        if (event.clipboardData) {
                            event.clipboardData.setData(
                                "text/plain",
                                "REDACTED"
                            );
                        }
                    }
                });
            })();
        </script>
    </body>
</html>
